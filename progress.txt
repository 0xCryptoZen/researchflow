# Better Ralph Progress

## 2026-02-16 23:30 - US-007 任务编辑 + 论文/会议关联
- 新增任务编辑功能（点击 ✏️ 按钮）
- 新增关联论文功能（下拉选择收藏的论文）
- 新增关联会议功能（下拉选择目标会议）
- 关联显示支持点击跳转
- 更新 tasksRepository 添加 update 方法和 relatedPaperId/relatedConferenceId 字段
- Files changed:
  - src/pages/Tasks.tsx
  - src/repositories/tasksRepository.ts
- **Learnings for future iterations:**
  - 任务与论文/会议的关联是多模块联动的典型场景
  - 使用下拉选择简化关联操作

## 2026-02-16 23:35 - US-015 仪表盘接入同步状态
- 仪表盘显示同步状态（已同步/同步中/未同步）
- 显示上次同步时间
- 添加"立即同步"按钮（模拟）
- Files changed:
  - src/pages/Dashboard.tsx
- **Learnings for future iterations:**
  - 同步状态展示提升用户体验
  - 真正的后端同步需 Cloudflare Workers D1

---

## 历史记录 (见上方)
- 实现了 GitHub 登录模拟功能，包含登录页面、用户菜单、登出功能
- Files changed:
  - src/pages/Login.tsx
  - src/services/auth.ts
  - src/components/layout/Layout.tsx
  - src/App.tsx
- **Learnings for future iterations:**
  - 使用 localStorage 模拟用户登录状态
  - 登录后自动跳转到首页
  - 未登录用户会被重定向到登录页
---
## 2026-02-16 12:35 - US-002
- 实现了研究领域选择功能，包含6个预设领域和推荐会议
- Files changed:
  - src/pages/ResearchFields.tsx
  - src/App.tsx
- **Learnings for future iterations:**
  - 使用数组存储多个研究领域
  - 根据领域动态显示推荐会议
## 2026-02-16 12:40 - US-003
- 实现了论文来源集成功能，包含 arXiv、DBLP API
- Files changed:
  - src/services/papers.ts
  - src/pages/Papers.tsx
- **Learnings for future iterations:**
  - ArXiv API 返回 XML 格式，需要解析
  - DBLP API 返回 JSON 格式
---
## 2026-02-16 22:40 - PRD & 系统流程优化
- 重构 PRD，修复重复/冲突的用户故事状态，按代码现状重新标注 completed/partial/not_started
- 新增系统流程文档，明确 As-Is/To-Be 流程、数据流问题与 P0/P1/P2 优先级
- 将 README 从模板说明改为项目实际说明与能力边界
- Files changed:
  - prd.json
  - docs/system-flow.md
  - README.md
- **Learnings for future iterations:**
  - PRD 需要和代码实现保持同一口径，避免“已完成”与实际不一致
  - 先做流程与数据边界澄清，再做代码重构，效率更高
---
## 2026-02-16 22:55 - P0-1 统一存储 key + 旧数据迁移
- 统一全项目存储 key 为 `researchflow_*`，并修复 Dashboard 与模块 key 不一致问题
- 新增迁移逻辑，自动兼容旧 key（如 user/papers/tasks 等）
- Files changed:
  - src/constants/storage.ts
  - src/main.tsx
  - src/pages/Dashboard.tsx
  - src/pages/Login.tsx
  - src/pages/Papers.tsx
  - src/pages/MyPapers.tsx
  - src/pages/Tasks.tsx
  - src/pages/Conferences.tsx
  - src/pages/Reminders.tsx
  - src/pages/References.tsx
  - src/pages/Outline.tsx
  - src/pages/Charts.tsx
  - src/pages/Submissions.tsx
  - src/pages/WritingProgress.tsx
  - src/services/auth.ts
  - src/services/db.ts
  - src/hooks/useUserSync.ts
- **Learnings for future iterations:**
  - key 统一是多模块联动的前置条件
  - 迁移逻辑应在入口执行，避免用户已有数据丢失
---
## 2026-02-16 23:05 - P0-2 收敛存储访问层
- 新增统一存储服务，提供 `readJSON/writeJSON/removeKey` 与变更事件
- 页面与服务由直接 localStorage 调用迁移到存储服务
- Dashboard 增加 `researchflow:storage-updated` 监听，实现跨模块即时刷新
- Files changed:
  - src/services/storage.ts
  - src/pages/Dashboard.tsx
  - src/services/auth.ts
  - src/services/db.ts
  - src/hooks/useUserSync.ts
  - src/pages/Login.tsx
  - src/pages/Papers.tsx
  - src/pages/MyPapers.tsx
  - src/pages/Tasks.tsx
  - src/pages/Conferences.tsx
  - src/pages/Reminders.tsx
  - src/pages/References.tsx
  - src/pages/Outline.tsx
  - src/pages/Charts.tsx
  - src/pages/Submissions.tsx
  - src/pages/WritingProgress.tsx
- **Learnings for future iterations:**
  - 存储事件机制能显著改善模块间数据一致性
  - 先统一 API 再做仓储抽象，可减少重构风险
---
## 2026-02-16 23:13 - P0-3 核心模块仓储化
- 新增 repository 层并落地 4 个核心域：论文、任务、会议、投稿
- 相关页面改为通过仓储读写，减少页面重复 CRUD 代码
- Dashboard 改为通过仓储聚合核心数据
- Files changed:
  - src/repositories/localRepository.ts
  - src/repositories/papersRepository.ts
  - src/repositories/tasksRepository.ts
  - src/repositories/conferencesRepository.ts
  - src/repositories/submissionsRepository.ts
  - src/pages/Papers.tsx
  - src/pages/MyPapers.tsx
  - src/pages/Tasks.tsx
  - src/pages/Conferences.tsx
  - src/pages/Submissions.tsx
  - src/pages/Dashboard.tsx
- **Learnings for future iterations:**
  - 通过 repository 层可把未来云同步改造集中到数据层
  - 优先仓储化高频核心模块，可最快降低维护复杂度

## 2026-02-18 11:25 - P1-1.1 接入 Google Scholar 搜索
- Cloudflare Worker 添加学术搜索 API 端点
  - /search/scholar: Google Scholar 搜索
  - /search/ieee: IEEE Xplore 搜索  
  - /search/acm: ACM DL 搜索
  - /search: 统一搜索接口
- 实现 arXiv/DBLP/IEEE/ACM 搜索函数
- 更新 papers.ts 前端服务调用统一搜索 API
- 更新 Papers.tsx 支持选择来源 (arXiv/DBLP/Scholar/IEEE/ACM)
- Files changed:
  - worker/src/index.ts
  - src/services/papers.ts
  - src/pages/Papers.tsx
- **Learnings:**
  - Google Scholar 无官方 API，使用 DBLP 作为主要来源
  - IEEE/ACM 需要 API Key 才能生产使用
  - 统一搜索入口便于扩展更多来源
- 新增 Service Worker (public/sw.ts) 实现静态资源缓存
  - Cache-first 策略缓存静态资源
  - 网络失败时返回缓存内容
  - 支持后台更新缓存
- 新增 IndexedDB 服务 (src/services/indexeddb.ts)
  - 离线数据存储 (offline_data store)
  - 操作队列存储 (operation_queue store)
  - 元数据存储 (meta store)
- 新增离线同步服务 (src/services/offline.ts)
  - 网络状态监听 (online/offline 事件)
  - 离线操作自动队列入库
  - 网络恢复后自动同步队列
- 新增 useOfflineStatus hook (src/hooks/useOfflineStatus.ts)
  - 感知网络状态
  - 感知待同步操作数量
- 修改 vite.config.ts 支持 worker
- 修改 index.html 注册 Service Worker
- 修改 main.tsx 初始化离线服务
- Files changed:
  - public/sw.ts
  - src/services/indexeddb.ts
  - src/services/offline.ts
  - src/hooks/useOfflineStatus.ts
  - vite.config.ts
  - index.html
  - src/main.tsx
- **Learnings:**
  - Service Worker 需要独立编译，dist 目录需要 .js 后缀
  - IndexedDB 是异步的，需要用 Promise 封装
  - 离线操作队列是本地优先架构的关键
- P0-2.1: 增量同步 API (已在 worker 中实现)
- P0-2.2: 改造 Repository 层支持云端模式
  - papersRepository/tasksRepository/conferencesRepository/submissionsRepository
  - 添加 cloud sync 集成，CRUD 操作自动同步到云端
- P0-3.1: 补齐剩余模块仓储化
  - 新增 remindersRepository (提醒)
  - 新增 referencesRepository (参考文献)
  - 新增 outlinesRepository (论文大纲)
  - 新增 chartsRepository (图表管理)
  - 新增 writingProgressRepository (写作进度)
- P0-3.2: storage service 事件机制 (已完成)
- Files changed:
  - src/repositories/*.ts (新增5个，修改4个)
  - src/services/sync.ts
  - src/services/auth.ts
  - src/pages/Dashboard.tsx
- **Learnings:**
  - Repository 层统一云端同步入口，便于后续扩展
  - 本地优先架构：所有操作先写本地，有云端时自动同步

---

## 2026-02-18 10:30 - P0 核心架构完成
- 完成 P0-1 Cloudflare Workers OAuth + D1 基础架构
- 完成 P0-2 数据同步能力（增量同步、Repository 云端模式）
- 完成 P0-3 存储层统一（5个新仓储）
- Files changed:
  - worker/ (Cloudflare Workers 后端)
  - src/repositories/*.ts (仓储层)
  - src/services/storage.ts (存储服务)
- **Learnings:**
  - Repository 模式为未来云同步打下基础
  - 离线缓存使用 IndexedDB 实现

## 2026-02-18 10:45 - P1 论文来源扩展
- 完成 P1-1 Google Scholar/IEEE/ACM 搜索
- 创建统一搜索 API 端点
- Files changed:
  - src/services/papers.ts
  - src/pages/Papers.tsx
  - worker/src/index.ts
- **Learnings:**
  - 各学术数据库 API 格式差异大，需要适配器模式

## 2026-02-18 11:00 - P1-2 会议自动更新
- 抓取会议官网 deadline 服务
- 实现 N 天规则化提醒（7天/3天/1天）
- Files changed:
  - src/services/conferences.ts
  - src/pages/Conferences.tsx
- **Learnings:**
  - 会议官网结构多样，需要针对每个会议单独适配

## 2026-02-18 11:15 - P2 提醒系统 + LaTeX 模板
- 多渠道通知服务（邮件/飞书/Telegram）
- LaTeX 模板预览/下载
- 内置 IEEE/ACM/arXiv 模板
- Files changed:
  - src/services/notifications.ts
  - src/pages/Reminders.tsx
- **Learnings:**
  - 通知渠道多样化提升用户体验

---

## 当前用户故事状态

| ID | 名称 | 状态 |
|----|------|------|
| US-001 | 用户注册与登录 | partial |
| US-002 | 研究领域选择 | completed |
| US-003 | 论文来源集成 | partial |
| US-004 | 论文收藏与管理 | completed |
| US-005 | 每日论文推荐 | not_started |
| US-006 | 会议截稿倒计时 | partial |
| US-007 | 任务/待办管理 | partial |
| US-008 | 提醒系统 | partial |
| US-009 | LaTeX 模板库 | partial |
| US-010 | 论文大纲生成 | partial |
| US-011 | 参考文献管理 | partial |
| US-012 | 图表管理 | not_started |
| US-013 | 投稿进度追踪 | completed |
| US-014 | 写作进度提醒 | partial |
| US-015 | 首页仪表盘 | completed |
| US-016 | 数据同步 | partial |

完成: 4 | 进行中: 10 | 未开始: 2
